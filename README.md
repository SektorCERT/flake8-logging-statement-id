# flake8-logging-statement-id

A linting rule that enforces every Python `logging` call includes a hardcoded UUID `statement_id` in the `extra` dict. **Supports auto-fix** to automatically insert UUIDs. Code has been generated by an LLM

## Why?

When debugging production issues, searching by log message is fragile — messages change, get duplicated, or contain dynamic content. A unique `statement_id` UUID per logging call gives you a stable, permanent identifier you can grep for across your codebase and log aggregation systems.

```python
# ✅ Correct
logger.info("User logged in", extra={"statement_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890", "user_id": user.id})

# ❌ Missing — but auto-fixable!
logger.info("User logged in")
```

## Auto-fix

Run with `--fix` to automatically insert `statement_id` UUIDs:

```bash
python flake8_logging_statement_id.py --fix src/**/*.py
```

**Before:**
```python
logger.info("User logged in")
logger.error("Failed", extra={"host": "db.prod"})
logger.warning("Slow", extra={"statement_id": "not-valid"})
```

**After:**
```python
logger.info("User logged in", extra={"statement_id": "a1b2c3d4-..."})
logger.error("Failed", extra={"statement_id": "e5f67890-...", "host": "db.prod"})
logger.warning("Slow", extra={"statement_id": "deadbeef-..."})
```

## Error Codes

| Code   | Description                                    | Auto-fix? |
|--------|------------------------------------------------|-----------|
| LOG001 | Logging call missing `extra` kwarg             | ✅ Yes    |
| LOG002 | `extra` is not a dict literal (e.g. a variable)| ❌ No     |
| LOG003 | `extra` dict missing `statement_id` key        | ✅ Yes    |
| LOG004 | `statement_id` value is not a string literal   | ❌ No     |
| LOG005 | `statement_id` value is not a valid UUID       | ✅ Yes    |

LOG002 and LOG004 require manual fixes because the tool can't safely modify non-literal expressions.

## Installation & Usage

### Pre-commit hook (recommended)

Add to your `.pre-commit-config.yaml`:

```yaml
- repo: https://github.com/SektorCERT/flake8-logging-statement-id
  rev: v1.0.0
  hooks:
    - id: logging-statement-id
```

This will auto-fix files on commit. If unfixable violations remain (LOG002/LOG004), the commit will be blocked with a clear error message.

### Standalone

```bash
# Check only
python flake8_logging_statement_id.py src/**/*.py

# Auto-fix
python flake8_logging_statement_id.py --fix src/**/*.py
```

### As a flake8 plugin (check-only, no auto-fix)

```bash
pip install -e .
flake8 --select=LOG your_project/
```

## Detected logging patterns

The rule catches all standard logging methods called as attributes:

- `logging.info(...)`, `logging.debug(...)`, etc.
- `logger.info(...)`, `log.warning(...)`, `LOG.error(...)`
- `self.logger.critical(...)`, `self.log.exception(...)`

Methods: `debug`, `info`, `warning`, `error`, `critical`, `exception`, `log`, `fatal`

## Generating UUIDs manually

```bash
python -c "import uuid; print(uuid.uuid4())"
uuidgen  # macOS/Linux
```

## License

MIT
